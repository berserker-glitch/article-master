[variables]
NIXPACKS_PYTHON_VERSION = "3.11"

[phases.setup]
nixPkgs = ["python311", "python311Packages.pip"]

[phases.install]
cmds = [
  "bun install",
  "echo 'Checking Python installation...'",
  "python3 --version || python --version || (echo 'ERROR: Python not found!' && exit 1)",
  "echo 'Installing Python dependencies...'",
  "pip3 install --no-cache-dir -r caption-extractor-2/requirements.txt || pip install --no-cache-dir -r caption-extractor-2/requirements.txt || (echo 'WARNING: Python deps install failed' && exit 0)",
  "echo 'Verifying youtube-transcript-api installation...'",
  "python3 -c 'import youtube_transcript_api; print(\"OK\")' || python -c 'import youtube_transcript_api; print(\"OK\")' || echo 'WARNING: youtube-transcript-api not importable'"
]

[phases.build]
cmds = [
  "bunx --bun prisma generate",
  "bun run build"
]

[start]
cmd = "bun run start"
